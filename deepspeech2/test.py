import torch
from deepspeech2.model import DeepSpeech2

inputs = torch.rand(3, 80, 100)  # BxDxT
input_lengths = [100, 90, 80]
input_lengths = torch.IntTensor(input_lengths)

model = DeepSpeech2(2000, 80, 512)
encoder_log_prob, encoder_output_lengths = model(inputs, input_lengths)

print(encoder_log_prob)
# tensor([[[-7.5646, -7.5956, -7.5385,  ..., -7.4806, -7.6209, -7.5414],
#          [-7.6042, -7.5858, -7.5577,  ..., -7.5093, -7.6588, -7.5539],
#          [-7.5926, -7.5642, -7.5653,  ..., -7.5719, -7.6169, -7.6385],
#          ...,
#          [-7.6601, -7.6333, -7.6181,  ..., -7.4243, -7.5609, -7.5674],
#          [-7.6194, -7.5913, -7.6072,  ..., -7.4592, -7.5485, -7.5888],
#          [-7.6379, -7.6257, -7.6000,  ..., -7.4861, -7.5965, -7.5805]],
#
#         [[-7.6026, -7.6154, -7.6340,  ..., -7.5079, -7.5972, -7.6163],
#          [-7.6099, -7.5997, -7.6141,  ..., -7.4983, -7.6636, -7.5685],
#          [-7.5884, -7.5828, -7.5954,  ..., -7.5229, -7.6359, -7.5749],
#          ...,
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838],
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838],
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838]],
#
#         [[-7.5444, -7.6116, -7.6306,  ..., -7.5439, -7.5891, -7.5721],
#          [-7.5471, -7.6197, -7.6303,  ..., -7.5492, -7.5691, -7.5391],
#          [-7.5515, -7.6203, -7.5936,  ..., -7.5454, -7.6365, -7.5760],
#          ...,
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838],
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838],
#          [-7.5927, -7.6199, -7.5855,  ..., -7.5813, -7.5815, -7.5838]]]
print(encoder_log_prob.size())  # torch.Size([3, 50, 2000])
print(encoder_output_lengths)  # tensor([50, 45, 40], dtype=torch.int32)
